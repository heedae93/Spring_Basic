# ë¹ˆ ìŠ¤ì½”í”„ (Bean Scope)

## 1. ë¹ˆ ìŠ¤ì½”í”„ë€?

ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ í•¨ê»˜ ìƒì„±ë˜ê³ ,
ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€ëœë‹¤ê³  í•™ìŠµí–ˆë‹¤.

ì´ê²ƒì€ **ìŠ¤í”„ë§ ë¹ˆì˜ ê¸°ë³¸ ìŠ¤ì½”í”„ê°€ ì‹±ê¸€í†¤(Singleton)** ì´ê¸° ë•Œë¬¸ì´ë‹¤.

**ìŠ¤ì½”í”„(Scope)** ë€  
ğŸ‘‰ *ë¹ˆì´ ì¡´ì¬í•˜ê³  ìœ ì§€ë˜ëŠ” ë²”ìœ„*ë¥¼ ì˜ë¯¸í•œë‹¤.

---

## 2. ìŠ¤í”„ë§ì´ ì§€ì›í•˜ëŠ” ìŠ¤ì½”í”„ ì¢…ë¥˜

### ê¸°ë³¸ ìŠ¤ì½”í”„
- **singleton**
    - ê¸°ë³¸ê°’
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì‹œì‘ ~ ì¢…ë£Œê¹Œì§€ ìœ ì§€
    - ê°€ì¥ ë„“ì€ ë²”ìœ„

- **prototype**
    - ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    - ìƒì„± + ì˜ì¡´ê´€ê³„ ì£¼ì… + ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬
    - ì´í›„ ê´€ë¦¬í•˜ì§€ ì•ŠìŒ

### ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„ (ì›¹ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥)
- **request** : HTTP ìš”ì²­ í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ ë¹ˆ
- **session** : HTTP ì„¸ì…˜ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°
- **application** : ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ë™ì¼
- **websocket** : ì›¹ì†Œì¼“ ìƒëª…ì£¼ê¸°ì™€ ë™ì¼

---

## 3. ìŠ¤ì½”í”„ ì§€ì • ë°©ë²•

### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìë™ ë“±ë¡

```java
@Scope("prototype")
@Component
public class HelloBean {}
```

### ìˆ˜ë™ ë¹ˆ ë“±ë¡

```java
@Scope("prototype")
@Bean
public HelloBean helloBean() {
    return new HelloBean();
}
```

---

## 4. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ë€?

### ì‹±ê¸€í†¤ ìŠ¤ì½”í”„
- ë¹ˆì„ ì¡°íšŒí•  ë•Œë§ˆë‹¤ **ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜**

### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„
- ë¹ˆì„ ì¡°íšŒí•  ë•Œë§ˆë‹¤ **í•­ìƒ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±**
- ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œì ì— ë¹ˆ ì •ì˜ë§Œ ë“±ë¡ì´ ë˜ê³  ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¡°íšŒí•  ë•Œ ìƒì„±ë˜ì–´ ë°˜í™˜í•˜ëŠ” ê²ƒ

**í•µì‹¬**
> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ”  
> í”„ë¡œí† íƒ€ì… ë¹ˆì˜ **ìƒì„±, ì˜ì¡´ê´€ê³„ ì£¼ì…, ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬**í•˜ê³   
> ê·¸ ì´í›„ëŠ” **ì „í˜€ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤**

---

## 5. ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ í…ŒìŠ¤íŠ¸

```java
public class SingletonTest {

    @Test
    void singletonBeanFind() {
        AnnotationConfigApplicationContext ac =
                new AnnotationConfigApplicationContext(SingletonBean.class);

        SingletonBean bean1 = ac.getBean(SingletonBean.class);
        SingletonBean bean2 = ac.getBean(SingletonBean.class);

        assertThat(bean1).isSameAs(bean2);
        ac.close();
    }

    @Scope("singleton")
    static class SingletonBean {

        @PostConstruct
        public void init() {
            System.out.println("SingletonBean.init");
        }

        @PreDestroy
        public void destroy() {
            System.out.println("SingletonBean.destroy");
        }
    }
}
```

---

## 6. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ í…ŒìŠ¤íŠ¸

```java
public class PrototypeTest {

    @Test
    void prototypeBeanFind() {
        AnnotationConfigApplicationContext ac =
                new AnnotationConfigApplicationContext(PrototypeBean.class);

        PrototypeBean bean1 = ac.getBean(PrototypeBean.class);
        PrototypeBean bean2 = ac.getBean(PrototypeBean.class);

        assertThat(bean1).isNotSameAs(bean2);
        ac.close();
    }

    @Scope("prototype")
    static class PrototypeBean {

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
```

**ì¤‘ìš”**
- `@PreDestroy` ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤
- í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ì¢…ë£Œ ì±…ì„ì€ **í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ìˆë‹¤**

---

## 7. ì‹±ê¸€í†¤ ë¹ˆ + í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš© ì‹œ ë¬¸ì œì 

### ë¬¸ì œ ìƒí™©

- ì‹±ê¸€í†¤ ë¹ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì…í•˜ë©´
- **ì£¼ì… ì‹œì ì— ìƒì„±ëœ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ê³„ì† ì¬ì‚¬ìš©ë¨**
- ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤

```java
@Scope("singleton")
static class ClientBean {

    private final PrototypeBean prototypeBean;

    @Autowired
    public ClientBean(PrototypeBean prototypeBean) {
        this.prototypeBean = prototypeBean;
    }

    public int logic() {
        prototypeBean.addCount();
        return prototypeBean.getCount();
    }
}
```

ğŸ‘‰ **ì˜ë„í•œ í”„ë¡œí† íƒ€ì… ë™ì‘ì´ ê¹¨ì§„ë‹¤**

---

## 8. í•´ê²° ë°©ë²• â‘  ApplicationContext ì§ì ‘ ì¡°íšŒ (ê¶Œì¥ âŒ)

```java
@Autowired
private ApplicationContext ac;

public int logic() {
    PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
    prototypeBean.addCount();
    return prototypeBean.getCount();
}
```

âŒ ë¬¸ì œì 
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°•í•˜ê²Œ ì˜ì¡´
- í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€
- DL(Dependency Lookup) ë‚¨ìš©

---

## 9. í•´ê²° ë°©ë²• â‘¡ ObjectProvider (ê¶Œì¥ âœ…)

```java
@Autowired
private ObjectProvider<PrototypeBean> prototypeBeanProvider;

public int logic() {
    PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
    prototypeBean.addCount();
    return prototypeBean.getCount();
}
```

### ObjectProvider íŠ¹ì§•
- í•„ìš”í•œ ì‹œì ì— ë¹ˆ ì¡°íšŒ (ì§€ì—°)
- í…ŒìŠ¤íŠ¸ ìš©ì´
- ìŠ¤í”„ë§ ì˜ì¡´ (í•˜ì§€ë§Œ ìµœì†Œ)

---

## 10. í•´ê²° ë°©ë²• â‘¢ JSR-330 Provider (ìë°” í‘œì¤€)

```java
@Autowired
private Provider<PrototypeBean> provider;

public int logic() {
    PrototypeBean prototypeBean = provider.get();
    prototypeBean.addCount();
    return prototypeBean.getCount();
}
```

### Provider íŠ¹ì§•
- ìë°” í‘œì¤€
- ìŠ¤í”„ë§ ì™¸ í™˜ê²½ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥
- ê¸°ëŠ¥ ë‹¨ìˆœ

---

## 11. ì›¹ ìŠ¤ì½”í”„ë€?

ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ëŠ” íŠ¹ë³„í•œ ìŠ¤ì½”í”„

### íŠ¹ì§•
- HTTP ìš”ì²­ ë‹¨ìœ„ë¡œ ê´€ë¦¬
- ì¢…ë£Œ ì‹œì ê¹Œì§€ ìŠ¤í”„ë§ì´ ê´€ë¦¬
- `@PreDestroy` í˜¸ì¶œë¨

---

## 12. request ìŠ¤ì½”í”„ ì˜ˆì œ

```java
@Component
@Scope(value = "request")
public class MyLogger {

    private String uuid;
    private String requestURL;

    public void setRequestURL(String requestURL) {
        this.requestURL = requestURL;
    }

    public void log(String message) {
        System.out.println("[" + uuid + "][" + requestURL + "] " + message);
    }

    @PostConstruct
    public void init() {
        uuid = UUID.randomUUID().toString();
        System.out.println("request scope bean create: " + this);
    }

    @PreDestroy
    public void close() {
        System.out.println("request scope bean close: " + this);
    }
}
```

---

## 13. request ìŠ¤ì½”í”„ ë¹ˆ ì£¼ì… ë¬¸ì œ

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ëœ¨ëŠ” ì‹œì  ì¦‰,  ì‹±ê¸€í†¤ ë¹ˆ ìƒì„± ì‹œì ì—ëŠ” ì•„ì§ ê³ ê°ì˜ ìš”ì²­ì´ ì—†ê¸° ë•Œë¬¸ì— request ìŠ¤ì½”í”„ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ ë°œìƒ

```java
@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```

```java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final MyLogger myLogger;

    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```

```
Scope 'request' is not active for the current thread
```

---

## 14. í•´ê²° ë°©ë²• â‘  ObjectProvider

```java

// httpìš”ì²­ì´ ë“¤ì–´ì˜¨ ë©”ì„œë“œì—ì„œ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ì—ëŸ¬ê°€ í•´ê²°ëœë‹¤.
@Controller
@RequiredArgsConstructor
public class LogDemoController {
  private final LogDemoService logDemoService;
  private final ObjectProvider<MyLogger> myLoggerObjectProvider;

  @RequestMapping("log-demo")
  @ResponseBody
  public String logDemo(HttpServletRequest request) {
    MyLogger myLogger = myLoggerObjectProvider.getObject();
    String requestURL = request.getRequestURL().toString();
    myLogger.setRequestURL(requestURL);
    myLogger.log("controller test");
    logDemoService.logic("testId");
    return "OK";
  }
}
```

```java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final ObjectProvider<MyLogger> myLoggerObjectProvider;

    public void logic(String id) {
        MyLogger myLogger = myLoggerObjectProvider.getObject();
        myLogger.log("service id = " + id);
    }
}
```

## ğŸš€ìŠ¤í”„ë§ ì›¹ ìŠ¤ì½”í”„ì™€ ObjectProvider ë™ì‘ ì›ë¦¬

### 1. ì»¨í…Œì´ë„ˆê°€ ëœ° ë•Œ (ì„œë²„ ê¸°ë™ ì‹œì )
* ìŠ¤í”„ë§ì€ `@Component`ê°€ ë¶™ì€ `MyLogger` í´ë˜ìŠ¤ë¥¼ ìŠ¤ìº”í•œë‹¤.
* "ì˜¤, `MyLogger` ë¹ˆ ì„¤ê³„ë„(ì„¤ëª…ì„œ) ë°œê²¬! ê·¼ë° ì´ê±´ `request` ìŠ¤ì½”í”„ë„¤?"ë¼ê³  ì¸ì§€í•œë‹¤.
* ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ë ¤ê³  ë³´ë‹ˆ `MyLogger`ê°€ í•„ìš”í•˜ë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆì€ HTTP ìš”ì²­ì´ ì—†ì–´ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ê°€ ì—†ë‹¤.
* ì´ë•Œ `ObjectProvider`ê°€ êµ¬ì›íˆ¬ìˆ˜ë¡œ ë“±ì¥í•œë‹¤. ìŠ¤í”„ë§ì€ **"ë‚˜ì¤‘ì— MyLogger ì„¤ëª…ì„œ ë³´ê³  ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ì–´ì¤„ ìˆ˜ ìˆëŠ” ë„êµ¬(Provider)"**ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì— ëŒ€ì‹  ê½‚ì•„ì¤€ë‹¤. ì„œë²„ëŠ” ì—ëŸ¬ ì—†ì´ ë¬´ì‚¬íˆ ì¼œì§„ë‹¤.

---

### 2. ì‹¤ì œ HTTP ìš”ì²­ì´ ì˜¬ ë•Œ (ëŸ°íƒ€ì„ ì‹œì )
* ì‚¬ìš©ìê°€ ì ‘ì†í•˜ì—¬ `logDemo()` ë©”ì„œë“œê°€ ì‹¤í–‰ëœë‹¤.
* `myLoggerObjectProvider.getObject()`ê°€ í˜¸ì¶œëœë‹¤.
* ì´ë•Œ Providerê°€ ë¹„ë¡œì†Œ `MyLogger` ì„¤ëª…ì„œë¥¼ ì§‘ì–´ ë“¤ê³ , "ì§€ê¸ˆ HTTP ìš”ì²­ì´ ë“¤ì–´ì™”ìœ¼ë‹ˆ ì´ì œì•¼ë§ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ ì°ì–´ë‚´ì•¼ê² ë‹¤!" í•˜ë©° ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
* ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ì˜ ì£¼ì†Œê°’ì„ ë‚´ ì½”ë“œì— ì „ë‹¬í•´ ì¤€ë‹¤.



---

### ğŸ’¡ ì—¬ê¸°ì„œ í•µì‹¬ í¬ì¸íŠ¸ (ë³µìŠµ)
**"ì„¤ëª…ì„œë¥¼ ë³´ê³  ë‚˜ì¤‘ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì¤€ë‹¤"**ëŠ” ë¶€ë¶„ì´ í•µì‹¬ì´ë‹¤.

* **ì‹±ê¸€í†¤**ì€ ì„œë²„ê°€ ëœ° ë•Œ ì„¤ëª…ì„œë¥¼ ë³´ê³  **ë¯¸ë¦¬** ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë‘”ë‹¤.
* **ë¦¬í€˜ìŠ¤íŠ¸ ìŠ¤ì½”í”„**ëŠ” ì„œë²„ê°€ ëœ° ë•Œ ì„¤ëª…ì„œë§Œ ë“¤ê³  ìˆë‹¤ê°€, **ì‹¤ì œ ìš”ì²­ì´ ì˜¤ë©´** ê·¸ì œì„œì•¼ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.

## ğŸ•µï¸â€â™‚ï¸ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ê°€ ê°™ì€ ë¹ˆì„ ê³µìœ í•˜ëŠ” ì›ë¦¬

### 1. HTTP ìš”ì²­ = ì „ìš© ì“°ë ˆë“œ í• ë‹¹í–ˆë‹¤.
* í†°ìº£ ê°™ì€ ì„œë²„ëŠ” HTTP ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ **ì“°ë ˆë“œë¥¼ í•˜ë‚˜ ë”± ë°°ì •**í•´ì¤€ë‹¤.
* ìš”ì²­ì´ ëë‚  ë•Œê¹Œì§€ ëª¨ë“  ë¡œì§(Controller -> Service -> Repository)ì€ **ê·¸ ì“°ë ˆë“œ ì•ˆì—ì„œë§Œ** ëŒì•„ê°€ê²Œ í–ˆë‹¤.

### 2. ì“°ë ˆë“œ ì•ˆì— ìˆ¨ê²¨ì§„ "ë¹„ë°€ ê¸ˆê³ "ë¥¼ í™œìš©í–ˆë‹¤.
* ìŠ¤í”„ë§ì€ ì´ ì“°ë ˆë“œ ì•ˆì— **"ì´ë²ˆ ìš”ì²­ì—ì„œë§Œ ì“¸ ë¹ˆë“¤ì„ ëª¨ì•„ë‘ëŠ” ë¹„ë°€ ê¸ˆê³ "**ë¥¼ ë§ˆë ¨í•´ë‘”ë‹¤.
* ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ìŒ `getObject()`ë¥¼ í•˜ë©´:
  1. ìŠ¤í”„ë§ì´ `MyLogger` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“ ë‹¤.
  2. ì´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•´ë‹¹ ì“°ë ˆë“œì˜ **ë¹„ë°€ ê¸ˆê³ **ì— ë”± ë„£ì–´ë‘”ë‹¤.
* ì„œë¹„ìŠ¤ì—ì„œ ë‘ ë²ˆì§¸ë¡œ `getObject()`ë¥¼ í•˜ë©´:
  1. ìŠ¤í”„ë§ì´ ë¨¼ì € **ë¹„ë°€ ê¸ˆê³ **ë¥¼ ë’¤ì ¸ë³¸ë‹¤.
  2. "ì–´? ì•„ê¹Œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë§Œë“¤ì–´ë‘” `MyLogger`ê°€ ì´ë¯¸ ìˆë„¤?" í•˜ê³  **ìƒˆë¡œ ì•ˆ ë§Œë“¤ê³  ë³´ê´€ ì¤‘ì¸ ê·¸ ë…€ì„ì„ êº¼ë‚´ì¤€ë‹¤.**



### 3. ì“°ë ˆë“œê°€ ë‹¤ë¥´ë©´ ì ˆëŒ€ ì•ˆ ì„ì´ê²Œ í–ˆë‹¤.
* ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ìš”ì²­ì€ **ë‹¤ë¥¸ ì“°ë ˆë“œ**ì—ì„œ ëŒì•„ê°€ë‹ˆê¹Œ, **ë‹¤ë¥¸ ë¹„ë°€ ê¸ˆê³ **ë¥¼ ì‚¬ìš©í•œë‹¤.
* ê·¸ë˜ì„œ ì‚¬ìš©ì Aì™€ ì‚¬ìš©ì Bì˜ `MyLogger`ëŠ” ì„œë¡œì˜ ì¡´ì¬ë„ ëª¨ë¥¸ ì±„ ì ˆëŒ€ ì„ì´ì§€ ì•Šê²Œ í–ˆë‹¤!

---

### ğŸ’¡ ìµœì¢… ìš”ì•½í–ˆë‹¤.
* **í•µì‹¬ ê¸°ìˆ **: **ì“°ë ˆë“œ(Thread)** ë‹¨ìœ„ë¡œ ê°ì²´ë¥¼ ë³´ê´€í•˜ëŠ” ê¸°ìˆ ì„ ì¼ë‹¤.
* **ê³µìœ  ì›ë¦¬**: ê°™ì€ ì“°ë ˆë“œ(í•˜ë‚˜ì˜ HTTP ìš”ì²­) ì•ˆì—ì„œëŠ” `getObject()`ë¥¼ ë°± ë²ˆ í˜¸ì¶œí•´ë„, ìŠ¤í”„ë§ì´ ê¸ˆê³ ì—ì„œ **ì´ë¯¸ ë§Œë“¤ì–´ë‘” ê°™ì€ ê°ì²´**ë¥¼ êº¼ë‚´ì£¼ê¸° ë•Œë¬¸ì— ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•  ìˆ˜ ìˆëŠ” ê±°ë‹¤!
---

## 15. í•´ê²° ë°©ë²• â‘¡ ìŠ¤ì½”í”„ í”„ë¡ì‹œ (ê¶Œì¥ â­â­â­)

```java
@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {}
```

```java
// ë‹¤ì‹œ MyLogger ì˜ì¡´ì„± ì£¼ì…ì„ ë°›ëŠ”ë‹¤.
@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
 
        String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```

```java
@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final MyLogger myLogger;

    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```



### ë™ì‘ ì›ë¦¬

![img.png](img.png)

- CGLIBìœ¼ë¡œ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ ìƒì„±í•´ì„œ ì£¼ì…í•´ ì¤€ë‹¤.
- ì‹¤ì œ ìš”ì²­ ì‹œ ì§„ì§œ request ë¹ˆì„ ì¡°íšŒ
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì‹±ê¸€í†¤ì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥

## ğŸ§™â€â™‚ï¸ ê°€ì§œ í”„ë¡ì‹œ(Proxy) ê°ì²´ì˜ ë™ì‘ê³¼ íŠ¹ì§•

### 1. ë™ì‘ ì›ë¦¬
* CGLIBë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì£¼ì…í•œë‹¤.
* ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ë‚´ë¶€ì—ì„œ ì§„ì§œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì„ ê°€ì§„ë‹¤.
* ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ë‚´ë¶€ì— ì§„ì§œ `myLogger`ë¥¼ ì°¾ëŠ” ë°©ë²•ì„ ì•Œê³  ìˆë‹¤.
* í´ë¼ì´ì–¸íŠ¸ê°€ `myLogger.log()`ë¥¼ í˜¸ì¶œí•˜ë©´ ì‚¬ì‹¤ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ ê²ƒì´ë‹¤.
* ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” request ìŠ¤ì½”í”„ì˜ ì§„ì§œ `myLogger.log()`ë¥¼ í˜¸ì¶œí•œë‹¤.
* ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ë§Œë“¤ì–´ì¡Œìœ¼ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì›ë³¸ ì—¬ë¶€ë¥¼ ëª¨ë¥¸ ì±„ ë‹¤í˜•ì„±ì„ í™œìš©í•´ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•œë‹¤.



### 2. íŠ¹ì§• ì •ë¦¬
* ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ request scopeì™€ ì§ì ‘ì ì¸ ê´€ê³„ê°€ ì—†ë‹¤. ë‹¨ìˆœí•œ ìœ„ì„ ë¡œì§ë§Œ ìˆëŠ” ê°€ì§œì´ë©° ì‹±ê¸€í†¤ì²˜ëŸ¼ ë™ì‘í•œë‹¤.
* í”„ë¡ì‹œ ê°ì²´ ë•ë¶„ì— í´ë¼ì´ì–¸íŠ¸ëŠ” ë§ˆì¹˜ ì‹±ê¸€í†¤ ë¹ˆì„ ì‚¬ìš©í•˜ë“¯ì´ í¸ë¦¬í•˜ê²Œ request scopeë¥¼ ì‚¬ìš©í•œë‹¤.
* Providerë¥¼ ì‚¬ìš©í•˜ë“  í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë“  í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ì§„ì§œ ê°ì²´ ì¡°íšŒë¥¼ ê¼­ í•„ìš”í•œ ì‹œì ê¹Œì§€ ì§€ì—° ì²˜ë¦¬í•œë‹¤ëŠ” ì ì´ë‹¤.



---

### ğŸ’¡ ìš”ì•½
* ê°€ì§œë¥¼ ë¯¸ë¦¬ ì„¸ì›Œë‘ê³  ì§„ì§œ ê°ì²´ ì¡°íšŒë¥¼ í•„ìš”í•œ ì‹œì ê¹Œì§€ ì§€ì—°í–ˆë‹¤.
* ì´ë¥¼ í†µí•´ ì›¹ ìŠ¤ì½”í”„ ë¹ˆì˜ ìƒì„± ì‹œì  ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì‹±ê¸€í†¤ì²˜ëŸ¼ í¸í•˜ê²Œ ì‚¬ìš©í•œë‹¤.


---

### ğŸ’¡ í•œ ì¤„ ìš”ì•½í–ˆë‹¤.
**"ê°€ì§œë¥¼ ì‹±ê¸€í†¤ì²˜ëŸ¼ ë¯¸ë¦¬ ì„¸ì›Œë‘ê³ , ì‹¤ì œ í˜¸ì¶œì´ ì¼ì–´ë‚  ë•Œë§Œ ì§„ì§œ ë¹ˆì„ ì°¾ì•„ì˜¤ê²Œ í•´ì„œ ì£¼ì… ì‹œì ì˜ ë¬¸ì œë¥¼ ì™„ë²½íˆ í•´ê²°í–ˆë‹¤!"**
---

## 16. ìŠ¤ì½”í”„ í”„ë¡ì‹œ í•µì‹¬ ì •ë¦¬

- ì‹¤ì œ ê°ì²´ ìƒì„±ì€ **ìš”ì²­ ì‹œì **
- í”„ë¡ì‹œëŠ” ì‹±ê¸€í†¤ì²˜ëŸ¼ ì£¼ì…ë¨
- ë‚´ë¶€ì—ì„œ ì§„ì§œ ê°ì²´ë¡œ ìœ„ì„
- DI + ë‹¤í˜•ì„± + ì§€ì—° ë¡œë”©ì˜ ê²°ì •íŒ

## ğŸ§™â€â™‚ï¸ ìŠ¤ì½”í”„ í”„ë¡ì‹œ(Proxy)ë§ˆë²•

### 1. ì„¤ì •ì€ ë”± í•œ ì¤„ë§Œ ì¶”ê°€
* `MyLogger` í´ë˜ìŠ¤ì˜ `@Scope` ì„¤ì •ì— `proxyMode` ì˜µì…˜ì„ ë„£ëŠ”ë‹¤.
```java
@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger { ... }
```
* ì´ë ‡ê²Œ í•˜ë©´ `ObjectProvider`ë¥¼ ì‹¹ ë‹¤ ì§€ìš°ê³ , ì²˜ìŒì— í•˜ê³  ì‹¶ì—ˆë˜ ê²ƒì²˜ëŸ¼ **`private final MyLogger myLogger;`**ë¡œ ë°”ë¡œ ì£¼ì…ë°›ì„ ìˆ˜ ìˆê²Œ í–ˆë‹¤.

### 2. ê°€ì§œ ê°ì²´(Proxy)ë¥¼ ë¯¸ë¦¬ ê½‚ì•„ì¤¬ë‹¤.
* ì„œë²„ê°€ ëœ° ë•Œ ì§„ì§œ `MyLogger`ëŠ” ë§Œë“¤ ìˆ˜ ì—†ìœ¼ë‹ˆ(ìš”ì²­ì´ ì—†ì–´ì„œ), ìŠ¤í”„ë§ì´ ì§„ì§œë¥¼ ì™ ë¹¼ë‹®ì€ **ê°€ì§œ(CGLIBì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë§Œë“  í”„ë¡ì‹œ ê°ì²´)**ë¥¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ì— ê½‚ì•„ë²„ë ¸ë‹¤.
* ì´ ê°€ì§œ ê°ì²´ëŠ” ë‚´ë¶€ì— **"ì§„ì§œ ë¹ˆì„ ì°¾ëŠ” ë¡œì§"**ë§Œ ë”± ë“¤ì–´ìˆëŠ” ê»ë°ê¸°ë‹¤.



### 3. í˜¸ì¶œí•˜ëŠ” ìˆœê°„ "ë°”ê¿”ì¹˜ê¸°" í–ˆë‹¤.
* ì‹¤ì œë¡œ `myLogger.log()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê·¸ ìˆœê°„, ê°€ì§œ ê°ì²´ ë‚´ë¶€ì— ìˆëŠ” ë¡œì§ì´ ì‘ë™í•œë‹¤.
* ê°€ì§œê°€ **"ì•„, ì§€ê¸ˆ HTTP ìš”ì²­ ë“¤ì–´ì™”ì§€? ì•„ê¹Œ ê·¸ ë¹„ë°€ ê¸ˆê³ (ThreadLocal)ì—ì„œ ì§„ì§œ MyLogger êº¼ë‚´ì™€!"**ë¼ê³  ë™ì‘í•´ì„œ ì§„ì§œì˜ ë©”ì„œë“œë¥¼ ëŒ€ì‹  í˜¸ì¶œí•´ì¤€ë‹¤.
* ê°œë°œì ì…ì¥ì—ì„œëŠ” ì´ê²Œ ê°€ì§œì¸ì§€ ì§„ì§œì¸ì§€ ì‹ ê²½ ì•ˆ ì“°ê³  ê·¸ëƒ¥ ì‹±ê¸€í†¤ ë¹ˆ ì“°ë“¯ì´ í¸í•˜ê²Œ ì“°ë©´ ë˜ê²Œ í–ˆë‹¤.

---

### ğŸ’¡ ìµœì¢… ìš”ì•½í–ˆë‹¤.
* **í•µì‹¬ ê¸°ìˆ **: **CGLIB**ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“ ë‹¤.
* **ì‚¬ìš© ì´ìœ **: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ **ì‹±ê¸€í†¤ ë¹ˆì„ ì“°ëŠ” ê²ƒì²˜ëŸ¼ ì•„ì£¼ ê¹”ë”í•˜ê²Œ ìœ ì§€**í•˜ë©´ì„œ, ë‚´ë¶€ì ìœ¼ë¡œëŠ” **ë¦¬í€˜ìŠ¤íŠ¸ ìŠ¤ì½”í”„ì˜ ì´ì (Thread ë³„ ê²©ë¦¬)**ì„ ë‹¤ ëˆ„ë¦´ ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´ì„œë‹¤!
* **ê²°ë¡ **: í”„ë¡ì‹œ ë°©ì‹ì´ë‚˜ Provider ë°©ì‹ì´ë‚˜ í•µì‹¬ì€ **"ì§„ì§œ ê°ì²´ ì¡°íšŒë¥¼ í•„ìš”í•œ ì‹œì ê¹Œì§€ ì§€ì—°ì²˜ë¦¬ í•œë‹¤"**ëŠ” ì ìœ¼ë¡œ ë˜‘ê°™ë‹¤!

---

## 17. ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ ì •ë¦¬

- í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ëŠ” ì‹¤ë¬´ì—ì„œ ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
- ì›¹ ìŠ¤ì½”í”„ë„ ê¼­ í•„ìš”í•œ ê²½ìš°ë§Œ ì‚¬ìš©
- ë¬´ë¶„ë³„í•œ ìŠ¤ì½”í”„ ì‚¬ìš©ì€ ìœ ì§€ë³´ìˆ˜ ë‚œì´ë„ í­ì¦

---

## 18. ìµœì¢… ì •ë¦¬

- ê¸°ë³¸ì€ **ì‹±ê¸€í†¤**
- í”„ë¡œí† íƒ€ì…ì€ íŠ¹ìˆ˜í•œ ê²½ìš°ë§Œ
- ì‹±ê¸€í†¤ + í”„ë¡œí† íƒ€ì… â†’ Provider ì‚¬ìš©
- ì›¹ ìŠ¤ì½”í”„ â†’ í”„ë¡ì‹œ ë°©ì‹ ê¶Œì¥
- **ìŠ¤ì½”í”„ëŠ” ê°•ë ¥í•˜ì§€ë§Œ ì‹ ì¤‘íˆ ì‚¬ìš©í•´ì•¼ í•œë‹¤**
